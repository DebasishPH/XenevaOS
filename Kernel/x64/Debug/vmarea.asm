; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.21005.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?AuInsertVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z ; AuInsertVMArea
PUBLIC	?AuRemoveVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z ; AuRemoveVMArea
PUBLIC	?AuVMAreaCreate@@YAPEAU_vm_area_@@_K0E0E@Z	; AuVMAreaCreate
PUBLIC	?AuVMAreaGet@@YAPEAU_vm_area_@@PEAU_au_proc_@@_K@Z ; AuVMAreaGet
EXTRN	memset:PROC
EXTRN	list_add:PROC
EXTRN	list_remove:PROC
EXTRN	list_get_at:PROC
EXTRN	kmalloc:PROC
EXTRN	kfree:PROC
pdata	SEGMENT
$pdata$?AuInsertVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z DD imagerel $LN3
	DD	imagerel $LN3+41
	DD	imagerel $unwind$?AuInsertVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z
$pdata$?AuRemoveVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z DD imagerel $LN7
	DD	imagerel $LN7+130
	DD	imagerel $unwind$?AuRemoveVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z
$pdata$?AuVMAreaCreate@@YAPEAU_vm_area_@@_K0E0E@Z DD imagerel $LN3
	DD	imagerel $LN3+147
	DD	imagerel $unwind$?AuVMAreaCreate@@YAPEAU_vm_area_@@_K0E0E@Z
$pdata$?AuVMAreaGet@@YAPEAU_vm_area_@@PEAU_au_proc_@@_K@Z DD imagerel $LN7
	DD	imagerel $LN7+127
	DD	imagerel $unwind$?AuVMAreaGet@@YAPEAU_vm_area_@@PEAU_au_proc_@@_K@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?AuInsertVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z DD 010e01H
	DD	0420eH
$unwind$?AuRemoveVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z DD 010e01H
	DD	0620eH
$unwind$?AuVMAreaCreate@@YAPEAU_vm_area_@@_K0E0E@Z DD 011801H
	DD	06218H
$unwind$?AuVMAreaGet@@YAPEAU_vm_area_@@PEAU_au_proc_@@_K@Z DD 010e01H
	DD	0620eH
xdata	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\mm\vmarea.cpp
_TEXT	SEGMENT
i$1 = 32
area_$2 = 40
proc$ = 64
address$ = 72
?AuVMAreaGet@@YAPEAU_vm_area_@@PEAU_au_proc_@@_K@Z PROC	; AuVMAreaGet

; 85   : AuVMArea* AuVMAreaGet(AuProcess* proc, size_t address) {

$LN7:
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 86   : 	for (int i = 0; i < proc->vmareas->pointer; i++) {

	mov	DWORD PTR i$1[rsp], 0
	jmp	SHORT $LN4@AuVMAreaGe
$LN3@AuVMAreaGe:
	mov	eax, DWORD PTR i$1[rsp]
	inc	eax
	mov	DWORD PTR i$1[rsp], eax
$LN4@AuVMAreaGe:
	mov	rax, QWORD PTR proc$[rsp]
	mov	rax, QWORD PTR [rax+1063]
	mov	eax, DWORD PTR [rax]
	cmp	DWORD PTR i$1[rsp], eax
	jae	SHORT $LN2@AuVMAreaGe

; 87   : 		AuVMArea* area_ = (AuVMArea*)list_get_at(proc->vmareas, i);

	mov	edx, DWORD PTR i$1[rsp]
	mov	rax, QWORD PTR proc$[rsp]
	mov	rcx, QWORD PTR [rax+1063]
	call	list_get_at
	mov	QWORD PTR area_$2[rsp], rax

; 88   : 		if (address >= area_->start && address <= area_->end)

	mov	rax, QWORD PTR area_$2[rsp]
	mov	rax, QWORD PTR [rax]
	cmp	QWORD PTR address$[rsp], rax
	jb	SHORT $LN1@AuVMAreaGe
	mov	rax, QWORD PTR area_$2[rsp]
	mov	rax, QWORD PTR [rax+8]
	cmp	QWORD PTR address$[rsp], rax
	ja	SHORT $LN1@AuVMAreaGe

; 89   : 			return area_;

	mov	rax, QWORD PTR area_$2[rsp]
	jmp	SHORT $LN5@AuVMAreaGe
$LN1@AuVMAreaGe:

; 90   : 	}

	jmp	SHORT $LN3@AuVMAreaGe
$LN2@AuVMAreaGe:

; 91   : 	return NULL;

	xor	eax, eax
$LN5@AuVMAreaGe:

; 92   : }

	add	rsp, 56					; 00000038H
	ret	0
?AuVMAreaGet@@YAPEAU_vm_area_@@PEAU_au_proc_@@_K@Z ENDP	; AuVMAreaGet
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\mm\vmarea.cpp
_TEXT	SEGMENT
area$ = 32
start$ = 64
end$ = 72
prot$ = 80
len$ = 88
type$ = 96
?AuVMAreaCreate@@YAPEAU_vm_area_@@_K0E0E@Z PROC		; AuVMAreaCreate

; 67   : AuVMArea* AuVMAreaCreate(size_t start, size_t end, uint8_t prot, size_t len, uint8_t type) {

$LN3:
	mov	QWORD PTR [rsp+32], r9
	mov	BYTE PTR [rsp+24], r8b
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 68   : 	AuVMArea *area = (AuVMArea*)kmalloc(sizeof(AuVMArea));

	mov	ecx, 34					; 00000022H
	call	kmalloc
	mov	QWORD PTR area$[rsp], rax

; 69   : 	memset(area, 0, sizeof(AuVMArea));

	mov	r8d, 34					; 00000022H
	xor	edx, edx
	mov	rcx, QWORD PTR area$[rsp]
	call	memset

; 70   : 	area->start = start;

	mov	rax, QWORD PTR area$[rsp]
	mov	rcx, QWORD PTR start$[rsp]
	mov	QWORD PTR [rax], rcx

; 71   : 	area->end = end;

	mov	rax, QWORD PTR area$[rsp]
	mov	rcx, QWORD PTR end$[rsp]
	mov	QWORD PTR [rax+8], rcx

; 72   : 	area->prot_flags = prot;

	mov	rax, QWORD PTR area$[rsp]
	movzx	ecx, BYTE PTR prot$[rsp]
	mov	BYTE PTR [rax+24], cl

; 73   : 	area->len = len;

	mov	rax, QWORD PTR area$[rsp]
	mov	rcx, QWORD PTR len$[rsp]
	mov	QWORD PTR [rax+16], rcx

; 74   : 	area->type = type;

	mov	rax, QWORD PTR area$[rsp]
	movzx	ecx, BYTE PTR type$[rsp]
	mov	BYTE PTR [rax+25], cl

; 75   : 	area->file = NULL;

	mov	rax, QWORD PTR area$[rsp]
	mov	QWORD PTR [rax+26], 0

; 76   : 	return area;

	mov	rax, QWORD PTR area$[rsp]

; 77   : }

	add	rsp, 56					; 00000038H
	ret	0
?AuVMAreaCreate@@YAPEAU_vm_area_@@_K0E0E@Z ENDP		; AuVMAreaCreate
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\mm\vmarea.cpp
_TEXT	SEGMENT
i$1 = 32
area_$2 = 40
proc$ = 64
area$ = 72
?AuRemoveVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z PROC ; AuRemoveVMArea

; 49   : void AuRemoveVMArea(AuProcess* proc, AuVMArea* area) {

$LN7:
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 50   : 	for (int i = 0; i < proc->vmareas->pointer; i++) {

	mov	DWORD PTR i$1[rsp], 0
	jmp	SHORT $LN4@AuRemoveVM
$LN3@AuRemoveVM:
	mov	eax, DWORD PTR i$1[rsp]
	inc	eax
	mov	DWORD PTR i$1[rsp], eax
$LN4@AuRemoveVM:
	mov	rax, QWORD PTR proc$[rsp]
	mov	rax, QWORD PTR [rax+1063]
	mov	eax, DWORD PTR [rax]
	cmp	DWORD PTR i$1[rsp], eax
	jae	SHORT $LN2@AuRemoveVM

; 51   : 		AuVMArea* area_ = (AuVMArea*)list_get_at(proc->vmareas, i);

	mov	edx, DWORD PTR i$1[rsp]
	mov	rax, QWORD PTR proc$[rsp]
	mov	rcx, QWORD PTR [rax+1063]
	call	list_get_at
	mov	QWORD PTR area_$2[rsp], rax

; 52   : 		if (area_ == area)

	mov	rax, QWORD PTR area$[rsp]
	cmp	QWORD PTR area_$2[rsp], rax
	jne	SHORT $LN1@AuRemoveVM

; 53   : 			list_remove(proc->vmareas, i);

	mov	edx, DWORD PTR i$1[rsp]
	mov	rax, QWORD PTR proc$[rsp]
	mov	rcx, QWORD PTR [rax+1063]
	call	list_remove
$LN1@AuRemoveVM:

; 54   : 	}

	jmp	SHORT $LN3@AuRemoveVM
$LN2@AuRemoveVM:

; 55   : 	kfree(area);

	mov	rcx, QWORD PTR area$[rsp]
	call	kfree

; 56   : }

	add	rsp, 56					; 00000038H
	ret	0
?AuRemoveVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z ENDP ; AuRemoveVMArea
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\mm\vmarea.cpp
_TEXT	SEGMENT
proc$ = 48
area$ = 56
?AuInsertVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z PROC ; AuInsertVMArea

; 39   : void AuInsertVMArea(AuProcess* proc, AuVMArea* area) {

$LN3:
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 40					; 00000028H

; 40   : 	list_add(proc->vmareas, area);

	mov	rdx, QWORD PTR area$[rsp]
	mov	rax, QWORD PTR proc$[rsp]
	mov	rcx, QWORD PTR [rax+1063]
	call	list_add

; 41   : }

	add	rsp, 40					; 00000028H
	ret	0
?AuInsertVMArea@@YAXPEAU_au_proc_@@PEAU_vm_area_@@@Z ENDP ; AuInsertVMArea
_TEXT	ENDS
END
