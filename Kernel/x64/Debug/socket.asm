; Listing generated by Microsoft (R) Optimizing Compiler Version 19.29.30154.0 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?raw_socket_list@@3PEAU_list_@@EA		; raw_socket_list
_BSS	SEGMENT
?raw_socket_list@@3PEAU_list_@@EA DQ 01H DUP (?)	; raw_socket_list
_BSS	ENDS
msvcjmc	SEGMENT
__6D2C3D37_socket@cpp DB 01H
msvcjmc	ENDS
PUBLIC	?AuSocketAdd@@YAXPEAU_socket_@@PEAX_K@Z		; AuSocketAdd
PUBLIC	?AuSocketInstall@@YAXXZ				; AuSocketInstall
PUBLIC	?AuCreateSocket@@YAHHHH@Z			; AuCreateSocket
PUBLIC	?AuSocketSetOpt@@YAHHHHPEBX_K@Z			; AuSocketSetOpt
PUBLIC	?AuRawSocketGetList@@YAPEAU_list_@@XZ		; AuRawSocketGetList
PUBLIC	?AuSocketGet@@YAPEAXPEAU_socket_@@@Z		; AuSocketGet
PUBLIC	?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z ; AuRawSocketReceive
PUBLIC	?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z ; AuRawSocketSend
PUBLIC	?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z	; AuSocketSOSocket
PUBLIC	?AuNetCreateSocket@@YAPEAU_socket_@@XZ		; AuNetCreateSocket
PUBLIC	?AuCreateRawSocket@@YAHHH@Z			; AuCreateRawSocket
PUBLIC	__JustMyCode_Default
PUBLIC	??_C@_0BH@EJJKFFBP@Device?5binding?5?9?$DO?$CFs?5?$AN?6@ ; `string'
PUBLIC	??_C@_0BB@CBPLOCMO@Device?5binded?5?$AN?6@	; `string'
EXTRN	initialize_list:PROC
EXTRN	list_add:PROC
EXTRN	AuStackCreate:PROC
EXTRN	AuStackPush:PROC
EXTRN	AuStackPop:PROC
EXTRN	?CreateIPv4Socket@@YAHHH@Z:PROC			; CreateIPv4Socket
EXTRN	AuGetCurrentThread:PROC
EXTRN	?AuProcessFindThread@@YAPEAU_au_proc_@@PEAU_au_thread_@@@Z:PROC ; AuProcessFindThread
EXTRN	?AuProcessFindSubThread@@YAPEAU_au_proc_@@PEAU_au_thread_@@@Z:PROC ; AuProcessFindSubThread
EXTRN	?AuProcessGetFileDesc@@YAHPEAU_au_proc_@@@Z:PROC ; AuProcessGetFileDesc
EXTRN	x64_cli:PROC
EXTRN	kmalloc:PROC
EXTRN	kfree:PROC
EXTRN	memset:PROC
EXTRN	memcpy:PROC
EXTRN	AuGetNetworkAdapter:PROC
EXTRN	SeTextOut:PROC
EXTRN	__CheckForDebuggerJustMyCode:PROC
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuSocketAdd@@YAXPEAU_socket_@@PEAX_K@Z DD imagerel $LN3
	DD	imagerel $LN3+136
	DD	imagerel $unwind$?AuSocketAdd@@YAXPEAU_socket_@@PEAX_K@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuSocketInstall@@YAXXZ DD imagerel $LN3
	DD	imagerel $LN3+41
	DD	imagerel $unwind$?AuSocketInstall@@YAXXZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuCreateSocket@@YAHHHH@Z DD imagerel $LN8
	DD	imagerel $LN8+97
	DD	imagerel $unwind$?AuCreateSocket@@YAHHHH@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuSocketSetOpt@@YAHHHHPEBX_K@Z DD imagerel $LN9
	DD	imagerel $LN9+205
	DD	imagerel $unwind$?AuSocketSetOpt@@YAHHHHPEBX_K@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuRawSocketGetList@@YAPEAU_list_@@XZ DD imagerel $LN3
	DD	imagerel $LN3+36
	DD	imagerel $unwind$?AuRawSocketGetList@@YAPEAU_list_@@XZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuSocketGet@@YAPEAXPEAU_socket_@@@Z DD imagerel $LN3
	DD	imagerel $LN3+54
	DD	imagerel $unwind$?AuSocketGet@@YAPEAXPEAU_socket_@@@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z DD imagerel $LN7
	DD	imagerel $LN7+218
	DD	imagerel $unwind$?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z DD imagerel $LN5
	DD	imagerel $LN5+146
	DD	imagerel $unwind$?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z DD imagerel $LN7
	DD	imagerel $LN7+136
	DD	imagerel $unwind$?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuNetCreateSocket@@YAPEAU_socket_@@XZ DD imagerel $LN3
	DD	imagerel $LN3+77
	DD	imagerel $unwind$?AuNetCreateSocket@@YAPEAU_socket_@@XZ
pdata	ENDS
;	COMDAT pdata
pdata	SEGMENT
$pdata$?AuCreateRawSocket@@YAHHH@Z DD imagerel $LN6
	DD	imagerel $LN6+268
	DD	imagerel $unwind$?AuCreateRawSocket@@YAHHH@Z
pdata	ENDS
;	COMDAT ??_C@_0BB@CBPLOCMO@Device?5binded?5?$AN?6@
CONST	SEGMENT
??_C@_0BB@CBPLOCMO@Device?5binded?5?$AN?6@ DB 'Device binded ', 0dH, 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0BH@EJJKFFBP@Device?5binding?5?9?$DO?$CFs?5?$AN?6@
CONST	SEGMENT
??_C@_0BH@EJJKFFBP@Device?5binding?5?9?$DO?$CFs?5?$AN?6@ DB 'Device bindi'
	DB	'ng ->%s ', 0dH, 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuCreateRawSocket@@YAHHH@Z DD 025041501H
	DD	01102315H
	DD	050090012H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuNetCreateSocket@@YAPEAU_socket_@@XZ DD 025030b01H
	DD	0d206230bH
	DD	05002H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z DD 025031d01H
	DD	0d218231dH
	DD	05014H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z DD 025031901H
	DD	0d2142319H
	DD	05010H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z DD 025031c01H
	DD	0f217231cH
	DD	05010H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuSocketGet@@YAPEAXPEAU_socket_@@@Z DD 025030f01H
	DD	0d20a230fH
	DD	05006H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuRawSocketGetList@@YAPEAU_list_@@XZ DD 025030b01H
	DD	0b206230bH
	DD	05002H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuSocketSetOpt@@YAHHHHPEBX_K@Z DD 025041f01H
	DD	011a231fH
	DD	050130012H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuCreateSocket@@YAHHHH@Z DD 025031701H
	DD	0d2122317H
	DD	0500eH
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuSocketInstall@@YAXXZ DD 025030b01H
	DD	0b206230bH
	DD	05002H
xdata	ENDS
;	COMDAT xdata
xdata	SEGMENT
$unwind$?AuSocketAdd@@YAXPEAU_socket_@@PEAX_K@Z DD 025031901H
	DD	0d2142319H
	DD	05010H
xdata	ENDS
; Function compile flags: /Odt
;	COMDAT __JustMyCode_Default
_TEXT	SEGMENT
__JustMyCode_Default PROC				; COMDAT
	ret	0
__JustMyCode_Default ENDP
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuCreateRawSocket@@YAHHH@Z
_TEXT	SEGMENT
curr_thr$ = 0
proc$ = 8
sock$ = 16
fd$ = 24
node$ = 32
type$ = 128
protocol$ = 136
?AuCreateRawSocket@@YAHHH@Z PROC			; AuCreateRawSocket, COMDAT

; 130  : int AuCreateRawSocket(int type, int protocol){

$LN6:
	mov	DWORD PTR [rsp+16], edx
	mov	DWORD PTR [rsp+8], ecx
	push	rbp
	sub	rsp, 144				; 00000090H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 131  : 	x64_cli();

	call	x64_cli

; 132  : 	if (type != SOCK_RAW)return -1;

	cmp	DWORD PTR type$[rbp], 3
	je	SHORT $LN2@AuCreateRa
	mov	eax, -1
	jmp	$LN1@AuCreateRa
$LN2@AuCreateRa:

; 133  : 	AuThread* curr_thr = AuGetCurrentThread();

	call	AuGetCurrentThread
	mov	QWORD PTR curr_thr$[rbp], rax

; 134  : 	AuProcess *proc = AuProcessFindThread(curr_thr);

	mov	rcx, QWORD PTR curr_thr$[rbp]
	call	?AuProcessFindThread@@YAPEAU_au_proc_@@PEAU_au_thread_@@@Z ; AuProcessFindThread
	mov	QWORD PTR proc$[rbp], rax

; 135  : 	if (!proc){

	cmp	QWORD PTR proc$[rbp], 0
	jne	SHORT $LN3@AuCreateRa

; 136  : 		proc = AuProcessFindSubThread(curr_thr);

	mov	rcx, QWORD PTR curr_thr$[rbp]
	call	?AuProcessFindSubThread@@YAPEAU_au_proc_@@PEAU_au_thread_@@@Z ; AuProcessFindSubThread
	mov	QWORD PTR proc$[rbp], rax

; 137  : 		if (!proc)

	cmp	QWORD PTR proc$[rbp], 0
	jne	SHORT $LN4@AuCreateRa

; 138  : 			return 1;

	mov	eax, 1
	jmp	$LN1@AuCreateRa
$LN4@AuCreateRa:
$LN3@AuCreateRa:

; 139  : 	}
; 140  : 	AuSocket* sock = AuNetCreateSocket();

	call	?AuNetCreateSocket@@YAPEAU_socket_@@XZ	; AuNetCreateSocket
	mov	QWORD PTR sock$[rbp], rax

; 141  : 	sock->receive = AuRawSocketReceive;

	mov	rax, QWORD PTR sock$[rbp]
	lea	rcx, OFFSET FLAT:?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z ; AuRawSocketReceive
	mov	QWORD PTR [rax+16], rcx

; 142  : 	sock->send = AuRawSocketSend;

	mov	rax, QWORD PTR sock$[rbp]
	lea	rcx, OFFSET FLAT:?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z ; AuRawSocketSend
	mov	QWORD PTR [rax+24], rcx

; 143  : 	int fd = AuProcessGetFileDesc(proc);

	mov	rcx, QWORD PTR proc$[rbp]
	call	?AuProcessGetFileDesc@@YAHPEAU_au_proc_@@@Z ; AuProcessGetFileDesc
	mov	DWORD PTR fd$[rbp], eax

; 144  : 	list_add(raw_socket_list, sock);

	mov	rdx, QWORD PTR sock$[rbp]
	mov	rcx, QWORD PTR ?raw_socket_list@@3PEAU_list_@@EA ; raw_socket_list
	call	list_add

; 145  : 	AuVFSNode* node = (AuVFSNode*)kmalloc(sizeof(AuVFSNode));

	mov	ecx, 178				; 000000b2H
	call	kmalloc
	mov	QWORD PTR node$[rbp], rax

; 146  : 	memset(node, 0, sizeof(AuVFSNode));

	mov	r8d, 178				; 000000b2H
	xor	edx, edx
	mov	rcx, QWORD PTR node$[rbp]
	call	memset

; 147  : 	node->flags = FS_FLAG_SOCKET;

	mov	eax, 512				; 00000200H
	mov	rcx, QWORD PTR node$[rbp]
	mov	WORD PTR [rcx+61], ax

; 148  : 	node->device = sock;

	mov	rax, QWORD PTR node$[rbp]
	mov	rcx, QWORD PTR sock$[rbp]
	mov	QWORD PTR [rax+64], rcx

; 149  : 	proc->fds[fd] = node;

	movsxd	rax, DWORD PTR fd$[rbp]
	mov	rcx, QWORD PTR proc$[rbp]
	mov	rdx, QWORD PTR node$[rbp]
	mov	QWORD PTR [rcx+rax*8+567], rdx

; 150  : 	return fd;

	mov	eax, DWORD PTR fd$[rbp]
$LN1@AuCreateRa:

; 151  : }

	lea	rsp, QWORD PTR [rbp+112]
	pop	rbp
	ret	0
?AuCreateRawSocket@@YAHHH@Z ENDP			; AuCreateRawSocket
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuNetCreateSocket@@YAPEAU_socket_@@XZ
_TEXT	SEGMENT
sock$ = 0
?AuNetCreateSocket@@YAPEAU_socket_@@XZ PROC		; AuNetCreateSocket, COMDAT

; 117  : AuSocket* AuNetCreateSocket() {

$LN3:
	push	rbp
	sub	rsp, 112				; 00000070H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 118  : 	AuSocket* sock = (AuSocket*)kmalloc(sizeof(AuSocket));

	mov	ecx, 56					; 00000038H
	call	kmalloc
	mov	QWORD PTR sock$[rbp], rax

; 119  : 	memset(sock, 0, sizeof(AuSocket));

	mov	r8d, 56					; 00000038H
	xor	edx, edx
	mov	rcx, QWORD PTR sock$[rbp]
	call	memset

; 120  : 	sock->rxstack = AuStackCreate();

	call	AuStackCreate
	mov	rcx, QWORD PTR sock$[rbp]
	mov	QWORD PTR [rcx+8], rax

; 121  : 	return sock;

	mov	rax, QWORD PTR sock$[rbp]

; 122  : }

	lea	rsp, QWORD PTR [rbp+80]
	pop	rbp
	ret	0
?AuNetCreateSocket@@YAPEAU_socket_@@XZ ENDP		; AuNetCreateSocket
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z
_TEXT	SEGMENT
nic$1 = 0
tv64 = 72
sock$ = 96
optname$ = 104
optval$ = 112
optlen$ = 120
?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z PROC	; AuSocketSOSocket, COMDAT

; 83   : int AuSocketSOSocket(AuSocket* sock, int optname, const void* optval, socklen_t optlen){

$LN7:
	mov	QWORD PTR [rsp+32], r9
	mov	QWORD PTR [rsp+24], r8
	mov	DWORD PTR [rsp+16], edx
	mov	QWORD PTR [rsp+8], rcx
	push	rbp
	sub	rsp, 112				; 00000070H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 84   : 	switch (optname){

	mov	eax, DWORD PTR optname$[rbp]
	mov	DWORD PTR tv64[rbp], eax
	cmp	DWORD PTR tv64[rbp], 3
	je	SHORT $LN4@AuSocketSO
	jmp	SHORT $LN2@AuSocketSO
$LN4@AuSocketSO:

; 85   : 	case SO_BINDTODEVICE: {   SeTextOut("Device binding ->%s \r\n", ((char*)optval));

	mov	rdx, QWORD PTR optval$[rbp]
	lea	rcx, OFFSET FLAT:??_C@_0BH@EJJKFFBP@Device?5binding?5?9?$DO?$CFs?5?$AN?6@
	call	SeTextOut

; 86   : 							  //if (optlen < 1 || optlen > 32 || ((const char*)optval)[optlen - 1] != 0) return -1;  
; 87   : 							  AuVFSNode* nic = AuGetNetworkAdapter((char*)optval);

	mov	rcx, QWORD PTR optval$[rbp]
	call	AuGetNetworkAdapter
	mov	QWORD PTR nic$1[rbp], rax

; 88   : 							  if (!nic) return -1;

	cmp	QWORD PTR nic$1[rbp], 0
	jne	SHORT $LN5@AuSocketSO
	mov	eax, -1
	jmp	SHORT $LN1@AuSocketSO
$LN5@AuSocketSO:

; 89   : 							  sock->binedDev = nic;

	mov	rax, QWORD PTR sock$[rbp]
	mov	rcx, QWORD PTR nic$1[rbp]
	mov	QWORD PTR [rax], rcx

; 90   : 							  SeTextOut("Device binded \r\n");

	lea	rcx, OFFSET FLAT:??_C@_0BB@CBPLOCMO@Device?5binded?5?$AN?6@
	call	SeTextOut

; 91   : 							  return 0;

	xor	eax, eax
	jmp	SHORT $LN1@AuSocketSO
$LN2@AuSocketSO:

; 92   : 	}
; 93   : 	}
; 94   : 	return 1;

	mov	eax, 1
$LN1@AuSocketSO:

; 95   : }

	lea	rsp, QWORD PTR [rbp+80]
	pop	rbp
	ret	0
?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z ENDP	; AuSocketSOSocket
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z
_TEXT	SEGMENT
device$ = 0
sock$ = 96
msg$ = 104
flags$ = 112
?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z PROC ; AuRawSocketSend, COMDAT

; 69   : int AuRawSocketSend(AuSocket* sock, msghdr* msg, int flags) {

$LN5:
	mov	DWORD PTR [rsp+24], r8d
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	push	rbp
	sub	rsp, 112				; 00000070H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 70   : 	if (!sock->binedDev) return -1;

	mov	rax, QWORD PTR sock$[rbp]
	cmp	QWORD PTR [rax], 0
	jne	SHORT $LN2@AuRawSocke
	mov	eax, -1
	jmp	SHORT $LN1@AuRawSocke
$LN2@AuRawSocke:

; 71   : 	if (msg->msg_iovlen == 0) return 0;

	mov	rax, QWORD PTR msg$[rbp]
	cmp	QWORD PTR [rax+24], 0
	jne	SHORT $LN3@AuRawSocke
	xor	eax, eax
	jmp	SHORT $LN1@AuRawSocke
$LN3@AuRawSocke:

; 72   : 	AuVFSNode* device = (AuVFSNode*)sock->binedDev;

	mov	rax, QWORD PTR sock$[rbp]
	mov	rax, QWORD PTR [rax]
	mov	QWORD PTR device$[rbp], rax

; 73   : 	device->write(device, device, (uint64_t*)msg->msg_iov[0].iov_base, msg->msg_iov[0].iov_len);

	mov	eax, 16
	imul	rax, rax, 0
	mov	rcx, QWORD PTR msg$[rbp]
	mov	rcx, QWORD PTR [rcx+16]
	mov	edx, 16
	imul	rdx, rdx, 0
	mov	r8, QWORD PTR msg$[rbp]
	mov	r8, QWORD PTR [r8+16]
	mov	r9d, DWORD PTR [rcx+rax+8]
	mov	r8, QWORD PTR [r8+rdx]
	mov	rdx, QWORD PTR device$[rbp]
	mov	rcx, QWORD PTR device$[rbp]
	mov	rax, QWORD PTR device$[rbp]
	call	QWORD PTR [rax+98]

; 74   : 	return 0;

	xor	eax, eax
$LN1@AuRawSocke:

; 75   : }

	lea	rsp, QWORD PTR [rbp+80]
	pop	rbp
	ret	0
?AuRawSocketSend@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z ENDP ; AuRawSocketSend
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z
_TEXT	SEGMENT
data$ = 0
pack_sz$ = 8
tv86 = 80
sock$ = 112
msg$ = 120
flags$ = 128
?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z PROC ; AuRawSocketReceive, COMDAT

; 56   : int AuRawSocketReceive(AuSocket* sock, msghdr* msg, int flags) {

$LN7:
	mov	DWORD PTR [rsp+24], r8d
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	push	rbp
	sub	rsp, 128				; 00000080H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 57   : 	if (!sock->binedDev)

	mov	rax, QWORD PTR sock$[rbp]
	cmp	QWORD PTR [rax], 0
	jne	SHORT $LN2@AuRawSocke

; 58   : 		return -1;

	mov	eax, -1
	jmp	$LN1@AuRawSocke
$LN2@AuRawSocke:

; 59   : 	if (msg->msg_iovlen == 0) return 0;

	mov	rax, QWORD PTR msg$[rbp]
	cmp	QWORD PTR [rax+24], 0
	jne	SHORT $LN3@AuRawSocke
	xor	eax, eax
	jmp	$LN1@AuRawSocke
$LN3@AuRawSocke:

; 60   : 	char* data = (char*)AuSocketGet(sock);

	mov	rcx, QWORD PTR sock$[rbp]
	call	?AuSocketGet@@YAPEAXPEAU_socket_@@@Z	; AuSocketGet
	mov	QWORD PTR data$[rbp], rax

; 61   : 	if (!data) return -1;

	cmp	QWORD PTR data$[rbp], 0
	jne	SHORT $LN4@AuRawSocke
	mov	eax, -1
	jmp	SHORT $LN1@AuRawSocke
$LN4@AuRawSocke:

; 62   : 	size_t pack_sz = *(size_t*)data;

	mov	rax, QWORD PTR data$[rbp]
	mov	rax, QWORD PTR [rax]
	mov	QWORD PTR pack_sz$[rbp], rax

; 63   : 	if (msg->msg_iov[0].iov_len < pack_sz) return -1;

	mov	eax, 16
	imul	rax, rax, 0
	mov	rcx, QWORD PTR msg$[rbp]
	mov	rcx, QWORD PTR [rcx+16]
	mov	rdx, QWORD PTR pack_sz$[rbp]
	cmp	QWORD PTR [rcx+rax+8], rdx
	jae	SHORT $LN5@AuRawSocke
	mov	eax, -1
	jmp	SHORT $LN1@AuRawSocke
$LN5@AuRawSocke:

; 64   : 	memcpy(msg->msg_iov[0].iov_base, data + sizeof(size_t), pack_sz);

	mov	rax, QWORD PTR data$[rbp]
	add	rax, 8
	mov	ecx, 16
	imul	rcx, rcx, 0
	mov	rdx, QWORD PTR msg$[rbp]
	mov	rdx, QWORD PTR [rdx+16]
	mov	QWORD PTR tv86[rbp], rdx
	mov	r8, QWORD PTR pack_sz$[rbp]
	mov	rdx, rax
	mov	rax, QWORD PTR tv86[rbp]
	mov	rcx, QWORD PTR [rax+rcx]
	call	memcpy

; 65   : 	kfree(data);

	mov	rcx, QWORD PTR data$[rbp]
	call	kfree

; 66   : 	return pack_sz;

	mov	eax, DWORD PTR pack_sz$[rbp]
$LN1@AuRawSocke:

; 67   : }

	lea	rsp, QWORD PTR [rbp+96]
	pop	rbp
	ret	0
?AuRawSocketReceive@@YAHPEAU_socket_@@PEAU_msghdr_@@H@Z ENDP ; AuRawSocketReceive
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuSocketGet@@YAPEAXPEAU_socket_@@@Z
_TEXT	SEGMENT
data$ = 0
sock$ = 96
?AuSocketGet@@YAPEAXPEAU_socket_@@@Z PROC		; AuSocketGet, COMDAT

; 51   : void* AuSocketGet(AuSocket* sock) {

$LN3:
	mov	QWORD PTR [rsp+8], rcx
	push	rbp
	sub	rsp, 112				; 00000070H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 52   : 	void* data = AuStackPop(sock->rxstack);

	mov	rax, QWORD PTR sock$[rbp]
	mov	rcx, QWORD PTR [rax+8]
	call	AuStackPop
	mov	QWORD PTR data$[rbp], rax

; 53   : 	return data;

	mov	rax, QWORD PTR data$[rbp]

; 54   : }

	lea	rsp, QWORD PTR [rbp+80]
	pop	rbp
	ret	0
?AuSocketGet@@YAPEAXPEAU_socket_@@@Z ENDP		; AuSocketGet
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuRawSocketGetList@@YAPEAU_list_@@XZ
_TEXT	SEGMENT
?AuRawSocketGetList@@YAPEAU_list_@@XZ PROC		; AuRawSocketGetList, COMDAT

; 183  : list_t* AuRawSocketGetList(){

$LN3:
	push	rbp
	sub	rsp, 96					; 00000060H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 184  : 	return raw_socket_list;

	mov	rax, QWORD PTR ?raw_socket_list@@3PEAU_list_@@EA ; raw_socket_list

; 185  : }

	lea	rsp, QWORD PTR [rbp+64]
	pop	rbp
	ret	0
?AuRawSocketGetList@@YAPEAU_list_@@XZ ENDP		; AuRawSocketGetList
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuSocketSetOpt@@YAHHHHPEBX_K@Z
_TEXT	SEGMENT
curr$ = 0
proc$ = 8
node$ = 16
sock$ = 24
tv76 = 96
sockfd$ = 128
level$ = 136
optname$ = 144
optval$ = 152
optlen$ = 160
?AuSocketSetOpt@@YAHHHHPEBX_K@Z PROC			; AuSocketSetOpt, COMDAT

; 97   : int AuSocketSetOpt(int sockfd, int level, int optname, const void* optval, socklen_t optlen) {

$LN9:
	mov	QWORD PTR [rsp+32], r9
	mov	DWORD PTR [rsp+24], r8d
	mov	DWORD PTR [rsp+16], edx
	mov	DWORD PTR [rsp+8], ecx
	push	rbp
	sub	rsp, 144				; 00000090H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 98   : 	x64_cli();

	call	x64_cli

; 99   : 	AuThread* curr = AuGetCurrentThread();

	call	AuGetCurrentThread
	mov	QWORD PTR curr$[rbp], rax

; 100  : 	AuProcess* proc = AuProcessFindThread(curr);

	mov	rcx, QWORD PTR curr$[rbp]
	call	?AuProcessFindThread@@YAPEAU_au_proc_@@PEAU_au_thread_@@@Z ; AuProcessFindThread
	mov	QWORD PTR proc$[rbp], rax

; 101  : 	if (!proc){

	cmp	QWORD PTR proc$[rbp], 0
	jne	SHORT $LN4@AuSocketSe

; 102  : 		proc = AuProcessFindSubThread(curr);

	mov	rcx, QWORD PTR curr$[rbp]
	call	?AuProcessFindSubThread@@YAPEAU_au_proc_@@PEAU_au_thread_@@@Z ; AuProcessFindSubThread
	mov	QWORD PTR proc$[rbp], rax

; 103  : 		if (!proc)

	cmp	QWORD PTR proc$[rbp], 0
	jne	SHORT $LN5@AuSocketSe

; 104  : 			return -1;

	mov	eax, -1
	jmp	SHORT $LN1@AuSocketSe
$LN5@AuSocketSe:
$LN4@AuSocketSe:

; 105  : 	}
; 106  : 	AuVFSNode* node = proc->fds[sockfd];

	movsxd	rax, DWORD PTR sockfd$[rbp]
	mov	rcx, QWORD PTR proc$[rbp]
	mov	rax, QWORD PTR [rcx+rax*8+567]
	mov	QWORD PTR node$[rbp], rax

; 107  : 	AuSocket* sock = (AuSocket*)node->device;

	mov	rax, QWORD PTR node$[rbp]
	mov	rax, QWORD PTR [rax+64]
	mov	QWORD PTR sock$[rbp], rax

; 108  : 	switch (level)

	mov	eax, DWORD PTR level$[rbp]
	mov	DWORD PTR tv76[rbp], eax
	cmp	DWORD PTR tv76[rbp], 0
	je	SHORT $LN6@AuSocketSe
	jmp	SHORT $LN7@AuSocketSe
$LN6@AuSocketSe:

; 109  : 	{
; 110  : 	case SOL_SOCKET:
; 111  : 		return AuSocketSOSocket(sock, optname, optval, optlen);

	mov	r9, QWORD PTR optlen$[rbp]
	mov	r8, QWORD PTR optval$[rbp]
	mov	edx, DWORD PTR optname$[rbp]
	mov	rcx, QWORD PTR sock$[rbp]
	call	?AuSocketSOSocket@@YAHPEAU_socket_@@HPEBX_K@Z ; AuSocketSOSocket
	jmp	SHORT $LN1@AuSocketSe
$LN7@AuSocketSe:

; 112  : 	default:
; 113  : 		return -1;

	mov	eax, -1
	jmp	SHORT $LN1@AuSocketSe

; 114  : 	}
; 115  : 	return -1;

	mov	eax, -1
$LN1@AuSocketSe:

; 116  : }

	lea	rsp, QWORD PTR [rbp+112]
	pop	rbp
	ret	0
?AuSocketSetOpt@@YAHHHHPEBX_K@Z ENDP			; AuSocketSetOpt
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuCreateSocket@@YAHHHH@Z
_TEXT	SEGMENT
tv64 = 64
domain$ = 96
type$ = 104
protocol$ = 112
?AuCreateSocket@@YAHHHH@Z PROC				; AuCreateSocket, COMDAT

; 160  : int AuCreateSocket(int domain, int type, int protocol) {

$LN8:
	mov	DWORD PTR [rsp+24], r8d
	mov	DWORD PTR [rsp+16], edx
	mov	DWORD PTR [rsp+8], ecx
	push	rbp
	sub	rsp, 112				; 00000070H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 161  : 	x64_cli();

	call	x64_cli

; 162  : 	switch (domain) {

	mov	eax, DWORD PTR domain$[rbp]
	mov	DWORD PTR tv64[rbp], eax
	cmp	DWORD PTR tv64[rbp], 1
	je	SHORT $LN4@AuCreateSo
	cmp	DWORD PTR tv64[rbp], 2
	je	SHORT $LN5@AuCreateSo
	jmp	SHORT $LN6@AuCreateSo
$LN4@AuCreateSo:

; 163  : 	case AF_INET:
; 164  : 		return CreateIPv4Socket(type, protocol);

	mov	edx, DWORD PTR protocol$[rbp]
	mov	ecx, DWORD PTR type$[rbp]
	call	?CreateIPv4Socket@@YAHHH@Z		; CreateIPv4Socket
	jmp	SHORT $LN1@AuCreateSo
$LN5@AuCreateSo:

; 165  : 	case AF_RAW:
; 166  : 		return AuCreateRawSocket(type, protocol);

	mov	edx, DWORD PTR protocol$[rbp]
	mov	ecx, DWORD PTR type$[rbp]
	call	?AuCreateRawSocket@@YAHHH@Z		; AuCreateRawSocket
	jmp	SHORT $LN1@AuCreateSo
$LN6@AuCreateSo:

; 167  : 	default:
; 168  : 		return -1;

	mov	eax, -1
$LN1@AuCreateSo:

; 169  : 	}
; 170  : }

	lea	rsp, QWORD PTR [rbp+80]
	pop	rbp
	ret	0
?AuCreateSocket@@YAHHHH@Z ENDP				; AuCreateSocket
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuSocketInstall@@YAXXZ
_TEXT	SEGMENT
?AuSocketInstall@@YAXXZ PROC				; AuSocketInstall, COMDAT

; 176  : void AuSocketInstall() {

$LN3:
	push	rbp
	sub	rsp, 96					; 00000060H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 177  : 	raw_socket_list = initialize_list();

	call	initialize_list
	mov	QWORD PTR ?raw_socket_list@@3PEAU_list_@@EA, rax ; raw_socket_list

; 178  : }

	lea	rsp, QWORD PTR [rbp+64]
	pop	rbp
	ret	0
?AuSocketInstall@@YAXXZ ENDP				; AuSocketInstall
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File E:\Xeneva Project\Aurora\Kernel\Net\socket.cpp
;	COMDAT ?AuSocketAdd@@YAXPEAU_socket_@@PEAX_K@Z
_TEXT	SEGMENT
data_$ = 0
sock$ = 96
data$ = 104
sz$ = 112
?AuSocketAdd@@YAXPEAU_socket_@@PEAX_K@Z PROC		; AuSocketAdd, COMDAT

; 43   : void AuSocketAdd(AuSocket* sock, void* data, size_t sz) {

$LN3:
	mov	QWORD PTR [rsp+24], r8
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	push	rbp
	sub	rsp, 112				; 00000070H
	lea	rbp, QWORD PTR [rsp+32]
	lea	rcx, OFFSET FLAT:__6D2C3D37_socket@cpp
	call	__CheckForDebuggerJustMyCode

; 44   : 	char* data_ = (char*)kmalloc(sizeof(size_t)+sz);

	mov	rax, QWORD PTR sz$[rbp]
	add	rax, 8
	mov	ecx, eax
	call	kmalloc
	mov	QWORD PTR data_$[rbp], rax

; 45   : 	memset(data_, 0, sz + sizeof(size_t));

	mov	rax, QWORD PTR sz$[rbp]
	add	rax, 8
	mov	r8d, eax
	xor	edx, edx
	mov	rcx, QWORD PTR data_$[rbp]
	call	memset

; 46   : 	*(size_t*)data_ = sz;

	mov	rax, QWORD PTR data_$[rbp]
	mov	rcx, QWORD PTR sz$[rbp]
	mov	QWORD PTR [rax], rcx

; 47   : 	memcpy(data_ + sizeof(size_t), data, sz);

	mov	rax, QWORD PTR data_$[rbp]
	add	rax, 8
	mov	r8, QWORD PTR sz$[rbp]
	mov	rdx, QWORD PTR data$[rbp]
	mov	rcx, rax
	call	memcpy

; 48   : 	AuStackPush(sock->rxstack, data_);

	mov	rdx, QWORD PTR data_$[rbp]
	mov	rax, QWORD PTR sock$[rbp]
	mov	rcx, QWORD PTR [rax+8]
	call	AuStackPush

; 49   : }

	lea	rsp, QWORD PTR [rbp+80]
	pop	rbp
	ret	0
?AuSocketAdd@@YAXPEAU_socket_@@PEAX_K@Z ENDP		; AuSocketAdd
_TEXT	ENDS
END
