; Listing generated by Microsoft (R) Optimizing Compiler Version 18.00.21005.1 

include listing.inc

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?netadapters@@3PEAUhashmap@@EA			; netadapters
_BSS	SEGMENT
?netadapters@@3PEAUhashmap@@EA DQ 01H DUP (?)		; netadapters
_BSS	ENDS
CONST	SEGMENT
$SG3018	DB	'/dev', 00H
	ORG $+3
$SG3019	DB	'/dev/net', 00H
	ORG $+3
$SG3025	DB	'/dev', 00H
	ORG $+7
$SG3026	DB	'/dev/net', 00H
	ORG $+3
$SG3035	DB	'e1000', 00H
CONST	ENDS
PUBLIC	?AuInitialiseNet@@YAXXZ				; AuInitialiseNet
PUBLIC	AuAddNetAdapter
PUBLIC	AuGetNetworkAdapter
PUBLIC	?AuNetworkRoute@@YAPEAU__VFS_NODE__@@I@Z	; AuNetworkRoute
EXTRN	AuVFSFind:PROC
EXTRN	AuHashmapCreate:PROC
EXTRN	AuHashmapSet:PROC
EXTRN	AuHashmapGet:PROC
EXTRN	?AuDevFSCreateFile@@YAHPEAU__VFS_NODE__@@PEADE@Z:PROC ; AuDevFSCreateFile
EXTRN	AuDevFSAddFile:PROC
pdata	SEGMENT
$pdata$?AuInitialiseNet@@YAXXZ DD imagerel $LN3
	DD	imagerel $LN3+63
	DD	imagerel $unwind$?AuInitialiseNet@@YAXXZ
$pdata$AuAddNetAdapter DD imagerel $LN3
	DD	imagerel $LN3+80
	DD	imagerel $unwind$AuAddNetAdapter
$pdata$AuGetNetworkAdapter DD imagerel $LN3
	DD	imagerel $LN3+41
	DD	imagerel $unwind$AuGetNetworkAdapter
$pdata$?AuNetworkRoute@@YAPEAU__VFS_NODE__@@I@Z DD imagerel $LN3
	DD	imagerel $LN3+25
	DD	imagerel $unwind$?AuNetworkRoute@@YAPEAU__VFS_NODE__@@I@Z
pdata	ENDS
xdata	SEGMENT
$unwind$?AuInitialiseNet@@YAXXZ DD 010401H
	DD	06204H
$unwind$AuAddNetAdapter DD 010e01H
	DD	0620eH
$unwind$AuGetNetworkAdapter DD 010901H
	DD	06209H
$unwind$?AuNetworkRoute@@YAPEAU__VFS_NODE__@@I@Z DD 010801H
	DD	04208H
xdata	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\net\aunet.cpp
_TEXT	SEGMENT
address$ = 48
?AuNetworkRoute@@YAPEAU__VFS_NODE__@@I@Z PROC		; AuNetworkRoute

; 76   : AuVFSNode* AuNetworkRoute(uint32_t address){

$LN3:
	mov	DWORD PTR [rsp+8], ecx
	sub	rsp, 40					; 00000028H

; 77   : 	/*if (address == 0x0100007F)*/ /* loop device */
; 78   : 	return AuGetNetworkAdapter("e1000");

	lea	rcx, OFFSET FLAT:$SG3035
	call	AuGetNetworkAdapter

; 79   : }

	add	rsp, 40					; 00000028H
	ret	0
?AuNetworkRoute@@YAPEAU__VFS_NODE__@@I@Z ENDP		; AuNetworkRoute
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\net\aunet.cpp
_TEXT	SEGMENT
node$ = 32
name$ = 64
AuGetNetworkAdapter PROC

; 66   : AuVFSNode* AuGetNetworkAdapter(char* name) {

$LN3:
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 67   : 	AuVFSNode* node = (AuVFSNode*)AuHashmapGet(netadapters, name);

	mov	rdx, QWORD PTR name$[rsp]
	mov	rcx, QWORD PTR ?netadapters@@3PEAUhashmap@@EA ; netadapters
	call	AuHashmapGet
	mov	QWORD PTR node$[rsp], rax

; 68   : 	return node;

	mov	rax, QWORD PTR node$[rsp]

; 69   : }

	add	rsp, 56					; 00000038H
	ret	0
AuGetNetworkAdapter ENDP
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\net\aunet.cpp
_TEXT	SEGMENT
fs$ = 32
netfs$ = 64
name$ = 72
AuAddNetAdapter PROC

; 53   : void AuAddNetAdapter(AuVFSNode* netfs, char* name) {

$LN3:
	mov	QWORD PTR [rsp+16], rdx
	mov	QWORD PTR [rsp+8], rcx
	sub	rsp, 56					; 00000038H

; 54   : 	AuHashmapSet(netadapters, name, netfs);

	mov	r8, QWORD PTR netfs$[rsp]
	mov	rdx, QWORD PTR name$[rsp]
	mov	rcx, QWORD PTR ?netadapters@@3PEAUhashmap@@EA ; netadapters
	call	AuHashmapSet

; 55   : 
; 56   : 	AuVFSNode* fs = AuVFSFind("/dev");

	lea	rcx, OFFSET FLAT:$SG3025
	call	AuVFSFind
	mov	QWORD PTR fs$[rsp], rax

; 57   : 	AuDevFSAddFile(fs, "/dev/net", netfs);

	mov	r8, QWORD PTR netfs$[rsp]
	lea	rdx, OFFSET FLAT:$SG3026
	mov	rcx, QWORD PTR fs$[rsp]
	call	AuDevFSAddFile

; 58   : 
; 59   : 
; 60   : }

	add	rsp, 56					; 00000038H
	ret	0
AuAddNetAdapter ENDP
_TEXT	ENDS
; Function compile flags: /Odtpy
; File e:\xeneva project\aurora\kernel\net\aunet.cpp
_TEXT	SEGMENT
fs$ = 32
?AuInitialiseNet@@YAXXZ PROC				; AuInitialiseNet

; 42   : void AuInitialiseNet() {

$LN3:
	sub	rsp, 56					; 00000038H

; 43   : 	netadapters = AuHashmapCreate(10);

	mov	ecx, 10
	call	AuHashmapCreate
	mov	QWORD PTR ?netadapters@@3PEAUhashmap@@EA, rax ; netadapters

; 44   : 	AuVFSNode* fs = AuVFSFind("/dev");

	lea	rcx, OFFSET FLAT:$SG3018
	call	AuVFSFind
	mov	QWORD PTR fs$[rsp], rax

; 45   : 	AuDevFSCreateFile(fs, "/dev/net", FS_FLAG_DIRECTORY);

	mov	r8b, 2
	lea	rdx, OFFSET FLAT:$SG3019
	mov	rcx, QWORD PTR fs$[rsp]
	call	?AuDevFSCreateFile@@YAHPEAU__VFS_NODE__@@PEADE@Z ; AuDevFSCreateFile

; 46   : }

	add	rsp, 56					; 00000038H
	ret	0
?AuInitialiseNet@@YAXXZ ENDP				; AuInitialiseNet
_TEXT	ENDS
END
